<!DOCTYPE html>
<!--
Archivo: index.html
Proyecto: Aplicaci√≥n para Crear, Editar y Eliminar Usuarios
Tecnolog√≠as: HTML, CSS, JavaScript, Express.js
-->
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Crear Usuario</title>
  <!-- Vincula la hoja de estilos externa -->
  <link rel="stylesheet" href="styles.css" />
  <!-- Dise√±o responsivo 
       üìå Esto le dice al navegador que use el ancho real del dispositivo (no uno simulado como en PC).
       Si tu archivo HTML no tiene esta l√≠nea en el <head>, los navegadores m√≥viles simulan una vista de escritorio, lo que hace que todo se vea diminuto y no se aplique el dise√±o m√≥vil correctamente.
  -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <!-- T√≠tulo principal -->
  <h1>Crear nuevo usuario</h1>

  <!-- Formulario de creaci√≥n de usuarios -->
  <form id="formulario">
    <!-- Campo para el nombre (texto, obligatorio, m√≠nimo 3 caracteres) -->
    <input type="text" id="nombre" placeholder="Nombre" required minlength="3"/>

    <!-- Campo para la edad (n√∫mero, obligatorio, entre 1 y 120) -->
    <input type="number" id="edad" placeholder="Edad" required min="1" max="120"/>

    <!-- Bot√≥n de env√≠o del formulario -->
    <button type="submit">Enviar</button>
  </form>

  <!-- Lista donde se mostrar√°n los usuarios existentes -->
  <h2>Lista de usuarios</h2>
  <ul id="lista-usuarios"></ul>

  <!-- Formulario de edici√≥n de usuario (inicialmente oculto) -->
  <form id="form-editar" style="display: none;">
    <h2>Editar usuario</h2>
    <input type="text" id="editar-nombre" placeholder="Nuevo nombre" required />
    <input type="number" id="editar-edad" placeholder="Nueva edad" required />
    <input type="hidden" id="editar-id" /> <!-- ID oculto del usuario -->
    <button type="submit">Actualizar</button>
  </form>

  <script>
    // Obtener el formulario de creaci√≥n
    const formulario = document.getElementById('formulario');

    // Evento al enviar el formulario de nuevo usuario
    formulario.addEventListener('submit', async (e) => {
      e.preventDefault(); // Evita recarga de p√°gina

      const nombre = document.getElementById('nombre').value.trim();
      const edad = document.getElementById('edad').value;

      // Validaciones manuales
      if (nombre.length < 3) {
        alert('‚ùå El nombre debe tener al menos 3 caracteres');
        return;
      }

      if (isNaN(edad) || edad < 1 || edad > 120) {
        alert('‚ùå La edad debe estar entre 1 y 120');
        return;
      }

      // Enviar datos al servidor (crear usuario)
      const respuesta = await fetch('http://192.168.0.5:3000/usuarios', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ nombre, edad })
      });

      const data = await respuesta.json();

      if (respuesta.ok) {
        alert('‚úÖ Usuario creado: ' + JSON.stringify(data));
        cargarUsuarios(); // Recarga la lista
      } else {
        alert('‚ùå Error: ' + data.error || 'Error desconocido');
      }
    });

    // Cargar usuarios desde la API y mostrarlos en la lista
    async function cargarUsuarios() {
      const respuesta = await fetch('http://192.168.0.5:3000/usuarios');
      const data = await respuesta.json();

      const lista = document.getElementById('lista-usuarios');
      lista.innerHTML = ''; // Limpiar lista

      data.forEach(usuario => {
        const item = document.createElement('li');
        item.innerHTML = `<span class="usuario-info">${usuario.nombre} (${usuario.edad} a√±os)</span>
  <div class="botones">
    <button onclick="mostrarFormularioEdicion('${usuario._id}', '${usuario.nombre}', ${usuario.edad})">Editar&nbsp;&nbsp;&nbsp;üñäÔ∏è</button>
    <button onclick="eliminarUsuario('${usuario._id}')">Eliminar&nbsp;&nbsp;&nbsp;‚úñÔ∏è</button>
  </div>`;
        lista.appendChild(item);
      });
    }

    // Ejecutar al cargar la p√°gina
    window.onload = cargarUsuarios;

    // Mostrar el formulario de edici√≥n con datos actuales del usuario
    function mostrarFormularioEdicion(id, nombre, edad) {
      document.getElementById('editar-nombre').value = nombre;
      document.getElementById('editar-edad').value = edad;
      document.getElementById('editar-id').value = id;
      document.getElementById('form-editar').style.display = 'block';
    }

    // Enviar cambios del formulario de edici√≥n
    document.getElementById('form-editar').addEventListener('submit', async (e) => {
      e.preventDefault();

      const id = document.getElementById('editar-id').value;
      const nombre = document.getElementById('editar-nombre').value;
      const edad = document.getElementById('editar-edad').value;

      // Validaciones
      if (nombre.length < 3) {
        alert('‚ùå El nombre debe tener al menos 3 caracteres');
        return;
      }

      if (isNaN(edad) || edad < 1 || edad > 120) {
        alert('‚ùå La edad debe estar entre 1 y 120');
        return;
      }

      // Enviar actualizaci√≥n al servidor
      const res = await fetch(`http://192.168.0.5:3000/usuarios/${id}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ nombre, edad })
      });

      const data = await res.json();

      if (res.ok) {
        alert('‚úÖ Usuario actualizado');
        document.getElementById('form-editar').style.display = 'none';
        cargarUsuarios();
      } else {
        alert('‚ùå Error al actualizar: ' + data.error);
      }
    });

    // Eliminar usuario desde la lista
    function eliminarUsuario(id) {
      if (!confirm('¬øEst√°s seguro de eliminar este usuario?')) return;

      fetch(`http://192.168.0.5:3000/usuarios/${id}`, {
        method: 'DELETE'
      })
      .then(res => res.json())
      .then(data => {
        alert(`üóëÔ∏è ${data.mensaje}`);
        cargarUsuarios();
      })
      .catch(err => {
        alert('‚ùå Error al eliminar: ' + err.message);
      });
    }
  </script>
</body>
</html>
